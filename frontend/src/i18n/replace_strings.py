#!/usr/bin/env python3
"""Batch replace hardcoded Spanish/English strings with t() calls in components."""
import os, re

BASE = "/app/frontend/src"

# Map of file -> list of (old_string, new_string) replacements
REPLACEMENTS = {
    "modules/admin/RolesModule.jsx": [
        ('"Roles y Permisos"', 't("roles.title")'),
        ('"Gestiona los roles del sistema y asigna permisos a usuarios"', 't("roles.titleDesc")'),
        ('"Nuevo Rol"', 't("roles.newRole")'),
        ('"Roles"', 't("roles.rolesTab")'),
        ('"Usuarios"', 't("roles.usersTab")'),
        ('"Auditoría"', 't("roles.auditTab")'),
        ('"Roles del Sistema"', 't("roles.systemRoles")'),
        ('"Editar Permisos"', 't("roles.editPermissions")'),
        ('"Selecciona un rol para ver sus detalles"', 't("roles.selectRoleDetails")'),
        ('"Acceso Total - Todos los permisos del sistema"', 't("roles.fullAccess")'),
        ('"Todos los permisos"', 't("roles.allPermissions")'),
        ('"Cambiar Rol"', 't("roles.changeRole")'),
        ('"Asignar Rol"', 't("roles.assignRole")'),
        ('"Selecciona el rol para"', 't("roles.assignRoleDesc")'),
        ('"El rol Super Admin otorga acceso total al sistema"', 't("roles.superAdminWarning")'),
        ('"Editar Rol"', 't("roles.editRole")'),
        ('"¿Eliminar este rol? Los usuarios con este rol serán cambiados a Usuario."', 't("roles.deleteRole")'),
        ("'Rol creado'", 't("roles.roleCreated")'),
        ("'Rol actualizado'", 't("roles.roleUpdated")'),
        ("'Rol eliminado'", 't("roles.roleDeleted")'),
        ("'Rol asignado correctamente'", 't("roles.roleAssigned")'),
        ('"El nombre es requerido"', 't("roles.nameRequired")'),
        ('"Nombre del Rol"', 't("roles.roleName")'),
        ('"Ej: Editor de Contenido"', 't("roles.roleNamePlaceholder")'),
        ('"Descripción"', 't("roles.roleDescription")'),
        ('"Breve descripción del rol"', 't("roles.roleDescPlaceholder")'),
        ('"Nivel Jerárquico"', 't("roles.hierarchyLevel")'),
        ('"Mayor nivel = más privilegios (1-99)"', 't("roles.hierarchyDesc")'),
        ('"Todos"', 't("roles.selectAll")'),
        ('"Solo puedes modificar los permisos de roles de sistema"', 't("roles.onlySystemPermsEditable")'),
        ('"Configura el nombre, nivel y permisos del rol"', 't("roles.configurePerms")'),
        ('"Guardar Cambios"', 't("roles.saveChanges")'),
        ('"Crear Rol"', 't("roles.createRole")'),
        ('"Total de registros"', 't("roles.totalRecords")'),
        ('"Últimas 24 horas"', 't("roles.last24h")'),
        ('"Roles asignados"', 't("roles.rolesAssigned")'),
        ('"Permisos actualizados"', 't("roles.permissionsUpdated")'),
        ('"Filtrar por actor o destino..."', 't("roles.filterByActorTarget")'),
        ('"Historial de Cambios"', 't("roles.changeHistory")'),
        ('"Registro de todas las acciones realizadas sobre roles y permisos"', 't("roles.changeHistoryDesc")'),
        ('"No hay registros de auditoría aún"', 't("roles.noAuditRecords")'),
        ('"modificó el rol"', 't("roles.modifiedRole")'),
        ('"modificó el rol de"', 't("roles.modifiedUserRole")'),
        ('"Rol anterior"', 't("roles.previousRole")'),
        ('"Rol nuevo"', 't("roles.newRoleLabel")'),
        ('"Agregados"', 't("roles.added")'),
        ('"Removidos"', 't("roles.removed")'),
        ('"más"', 't("roles.more")'),
        ('"Sin nombre"', 't("roles.noName")'),
        ("'Error al cargar datos'", 't("roles.loadError")'),
        ("'Error al cargar logs de auditoría'", 't("roles.auditLoadError")'),
    ],
    "modules/admin/AuthMethodsConfig.jsx": [
        ('"Métodos de Autenticación"', 't("authConfig.title")'),
        ('"Configura los métodos de inicio de sesión y registro disponibles"', 't("authConfig.titleDesc")'),
        ('"Métodos de Inicio de Sesión"', 't("authConfig.loginMethods")'),
        ('"Habilita o deshabilita los métodos de autenticación disponibles para los usuarios"', 't("authConfig.loginMethodsDesc")'),
        ('"Email y Contraseña"', 't("authConfig.emailPassword")'),
        ('"Activo"', 't("authConfig.activeStatus")'),
        ('"Deshabilitado"', 't("authConfig.disabledStatus")'),
        ('"Google Auth deshabilitado - no visible para usuarios"', 't("authConfig.googleDisabledNote")'),
        ('"Texto del botón (opcional)"', 't("authConfig.buttonText")'),
        ('"El método de Email y Contraseña no se puede deshabilitar ya que es el método principal."', 't("authConfig.emailMethodNote")'),
        ('"Campos de Registro"', 't("authConfig.registrationFields")'),
        ('"Configura qué campos se muestran en el formulario de registro"', 't("authConfig.registrationFieldsDesc")'),
        ('"Esencial"', 't("authConfig.essential")'),
        ('"Auto-captura"', 't("authConfig.autoCapture")'),
        ('"Captura Automática de Ubicación"', 't("authConfig.locationCapture")'),
        ('"Capturar la ubicación del usuario automáticamente al registrarse (usando IP)"', 't("authConfig.locationCaptureDesc")'),
        ('"Cuando está habilitado, se guardará la ubicación aproximada del usuario basada en su dirección IP."', 't("authConfig.locationCaptureNote")'),
        ('"Esta información se almacena como historial y no se muestra al usuario."', 't("authConfig.locationHistoryNote")'),
        ("'Configuración guardada'", 't("authConfig.configSaved")'),
        ("'Error al cargar configuración'", 't("authConfig.configLoadError")'),
        ("'Error al guardar'", 't("authConfig.saveError")'),
    ],
    "modules/admin/FormConfigModule.jsx": [
        ('"Configuración del Formulario"', 't("formConfig.title")'),
        ('"Personaliza el formulario de pedidos público"', 't("formConfig.titleDesc")'),
        ('"Título del Formulario"', 't("formConfig.formTitle")'),
        ('"Descripción"', 't("formConfig.formDescription")'),
        ('"Mensaje de Éxito"', 't("formConfig.successMessage")'),
        ('"Mostrar Precios"', 't("formConfig.showPrices")'),
        ('"Mostrar precios en el formulario"', 't("formConfig.showPricesDesc")'),
        ('"Color Primario"', 't("formConfig.primaryColor")'),
        ('"URL del Formulario"', 't("formConfig.formUrl")'),
        ('"Comparte esta URL o incrústala en tu sitio web"', 't("formConfig.formUrlDesc")'),
        ('"Guardar Configuración"', 't("formConfig.saveConfig")'),
        ("'Configuración guardada'", 't("formConfig.configSaved")'),
        ("'URL copiada'", 't("formConfig.urlCopied")'),
        ("'Error al guardar'", 't("formConfig.saveError")'),
    ],
    "modules/admin/DemoDataModule.jsx": [
        ('"Datos de Demostración"', 't("demoData.title")'),
        ('"Genera datos ficticios para probar y demostrar la aplicación"', 't("demoData.titleDesc")'),
        ('"Crear Datos Demo"', 't("demoData.createDemoData")'),
        ('"Creando datos..."', 't("demoData.creatingData")'),
        ('"Limpiar Datos Demo"', 't("demoData.clearDemoData")'),
        ('"Eliminando..."', 't("demoData.deleting")'),
        ('"Confirmar Eliminación"', 't("demoData.confirmDeleteTitle")'),
        ('"¿Estás seguro de que deseas eliminar todos los datos de demostración?"', 't("demoData.confirmDeleteDesc")'),
        ('"Sí, Eliminar"', 't("demoData.yesDelete")'),
        ('"¿Qué incluyen los datos demo?"', 't("demoData.whatIncluded")'),
        ("'¡Datos demo creados exitosamente!'", 't("demoData.demoCreatedSuccess")'),
        ("'Datos demo eliminados'", 't("demoData.demoDeletedSuccess")'),
        ("'Error al crear datos demo'", 't("demoData.createError")'),
        ("'Error al eliminar datos demo'", 't("demoData.deleteError")'),
    ],
    "components/layout/BottomNav.jsx": [
        ('"Inicio"', 't("common.home")'),
        ('"Tienda"', 't("common.store")'),
        ('"Carrito"', 't("common.cart")'),
        ('"Club"', 't("common.club")'),
        ('"Yo"', 't("common.me")'),
        ('"Ingresar"', 't("common.login")'),
    ],
    "components/layout/NotificationBar.jsx": [
        ('"Pedidos Nuevos"', 't("notifBar.newOrders")'),
        ('"Bajo Stock"', 't("notifBar.lowStock")'),
        ('"Pagos Confirmados"', 't("notifBar.confirmedPayments")'),
        ('"Pedidos Enviados"', 't("notifBar.shippedOrders")'),
        ('"Matrículas Pendientes"', 't("notifBar.pendingEnrollments")'),
        ('"Matrículas Verificadas"', 't("notifBar.verifiedEnrollments")'),
        ('"Sin notificaciones nuevas"', 't("notifBar.noNewNotifications")'),
        ('"Mostrar Notificaciones"', 't("notifBar.showNotifications")'),
        ('"Marcar todas"', 't("notifBar.markAll")'),
        ('"No hay notificaciones"', 't("notifBar.noNotifications")'),
        ('"Ahora"', 't("notifBar.now")'),
    ],
    "modules/community/CommunityFeedModule.jsx": [
        ('"Comunidad"', 't("community.title")'),
        ('"Actualizar"', 't("community.refresh")'),
        ('"Cargando feed..."', 't("common.loadingFeed")'),
        ('"Sin publicaciones aún"', 't("common.noPosts")'),
        ('"publicaciones de nuestro canal"', 't("common.postsFromChannel")'),
        ('"Mantente conectado con la comunidad"', 't("common.stayConnected")'),
    ],
    "modules/monday/MondayModule.jsx": [
        ('"Monday.com"', 't("monday.title")'),
        ('"Configura la sincronización con Monday.com"', 't("monday.titleDesc")'),
        ('"Espacios de Trabajo"', 't("monday.workspacesTab")'),
        ('"Pedidos de Libros"', 't("monday.bookOrdersTab")'),
        ('"Inventario TXB"', 't("monday.txbInventoryTab")'),
        ('"Webhooks"', 't("monday.webhooksTab")'),
        ('"Billetera"', 't("monday.walletTab")'),
        ('"Panel de Sincronización"', 't("monday.syncDashboardTab")'),
        ('"Mapeo de Estado"', 't("monday.statusMappingTab")'),
        ('"General"', 't("monday.generalTab")'),
        ('"Conexión Activa"', 't("monday.activeConnection")'),
        ('"Espacios de Trabajo Configurados"', 't("monday.configuredWorkspaces")'),
        ('"Agregar Espacio"', 't("monday.addWorkspace")'),
        ('"Probar Integración"', 't("monday.testIntegration")'),
        ('"Abrir Monday.com"', 't("monday.openMonday")'),
        ("'Espacio agregado'", 't("monday.workspaceAdded")'),
        ("'Espacio activado'", 't("monday.workspaceActivated")'),
        ("'Espacio eliminado'", 't("monday.workspaceDeleted")'),
        ('"¿Estás seguro de que deseas eliminar este espacio de trabajo?"', 't("monday.deleteWorkspaceConfirm")'),
        ('"Ingresa una API Key válida"', 't("monday.enterValidKey")'),
    ],
    "modules/store/StoreModule.jsx": [
        ('"Productos"', 't("storeManager.productsTab")'),
        ('"Categorías"', 't("storeManager.categoriesTab")'),
        ('"Inventario"', 't("storeManager.inventoryTab")'),
        ('"Buscar productos..."', 't("storeManager.searchProducts")'),
        ('"Todas las categorías"', 't("storeManager.allCategories")'),
        ('"Agregar"', 't("storeManager.addProduct")'),
        ('"Agregar Varios"', 't("storeManager.addMultiple")'),
        ('"Editar Producto"', 't("storeManager.editProduct")'),
        ('"Nuevo Producto"', 't("storeManager.newProduct")'),
        ('"Categorías de Productos"', 't("storeManager.productCategories")'),
        ('"Nueva Categoría"', 't("storeManager.newCategory")'),
        ('"Editar Categoría"', 't("storeManager.editCategory")'),
        ("'Categoría creada'", 't("storeManager.categoryCreated")'),
        ("'Categoría actualizada'", 't("storeManager.categoryUpdated")'),
        ("'Categoría eliminada'", 't("storeManager.categoryDeleted")'),
        ("'Producto creado'", 't("storeManager.productCreated")'),
        ("'Producto actualizado'", 't("storeManager.productUpdated")'),
        ("'Producto eliminado'", 't("storeManager.productDeleted")'),
        ('"¿Eliminar esta categoría?"', 't("storeManager.deleteCategory")'),
        ('"¿Eliminar este producto?"', 't("storeManager.deleteProduct")'),
        ('"Guardar Categoría"', 't("storeManager.saveCategory")'),
        ("'Error al cargar datos'", 't("storeManager.loadError")'),
    ],
    "modules/account/linking/LinkingPage.jsx": [
        ('"Textos PCA"', 't("linking.title")'),
        ('"Vincula estudiantes para acceder a textos escolares exclusivos"', 't("linking.titleDesc")'),
        ('"Vincular Estudiante"', 't("linking.linkStudent")'),
        ('"Mis Estudiantes"', 't("linking.myStudents")'),
        ('"No hay estudiantes vinculados aún"', 't("linking.noStudentsLinked")'),
        ('"Nombre"', 't("linking.firstName")'),
        ('"Apellido"', 't("linking.lastName")'),
        ('"Escuela"', 't("linking.school")'),
        ('"Seleccionar escuela"', 't("linking.selectSchool")'),
        ('"Grado"', 't("linking.gradeLabel")'),
        ('"Parentesco"', 't("linking.relationship")'),
        ('"Seleccionar parentesco"', 't("linking.selectRelationship")'),
        ('"Padre/Madre"', 't("linking.parent")'),
        ('"Tutor Legal"', 't("linking.guardian")'),
        ('"Abuelo/a"', 't("linking.grandparent")'),
        ('"Representante"', 't("linking.representative")'),
        ('"Otro"', 't("linking.otherRelation")'),
        ('"Enviar Solicitud"', 't("linking.submitRequest")'),
        ("'¡Estudiante vinculado exitosamente!'", 't("linking.linkedSuccess")'),
        ('"Inicia sesión para acceder a esta función"', 't("linking.loginRequired")'),
    ],
    "modules/unatienda/tabs/InventoryTab.jsx": [
        ('"Total Productos"', 't("inventoryMgmt.totalProducts")'),
        ('"Stock Total"', 't("inventoryMgmt.totalStock")'),
        ('"Valor del Stock"', 't("inventoryMgmt.stockValue")'),
        ('"Stock Bajo"', 't("inventoryMgmt.lowStock")'),
        ('"Sin Stock"', 't("inventoryMgmt.outOfStock")'),
        ('"Productos"', 't("inventoryMgmt.productsView")'),
        ('"Historial"', 't("inventoryMgmt.historyView")'),
        ('"Buscar productos..."', 't("inventoryMgmt.searchProducts")'),
        ('"Todo el Stock"', 't("inventoryMgmt.allStock")'),
        ('"En Stock (>10)"', 't("inventoryMgmt.inStockFilter")'),
        ('"Stock Bajo (1-10)"', 't("inventoryMgmt.lowStockFilter")'),
        ('"Ajustar Stock"', 't("inventoryMgmt.adjustStock")'),
        ('"Stock Actual"', 't("inventoryMgmt.currentStock")'),
        ('"Agregar Stock"', 't("inventoryMgmt.addStock")'),
        ('"Quitar"', 't("inventoryMgmt.removeStock")'),
        ('"Cantidad"', 't("inventoryMgmt.quantityLabel")'),
        ('"Razón"', 't("inventoryMgmt.reasonLabel")'),
        ('"Notas (opcional)"', 't("inventoryMgmt.notesLabel")'),
        ('"Nuevo stock"', 't("inventoryMgmt.newStockLabel")'),
        ('"unidades"', 't("inventoryMgmt.units")'),
        ('"Reposición / Nuevo envío"', 't("inventoryMgmt.restock")'),
        ('"Corrección manual"', 't("inventoryMgmt.manualAdjustment")'),
        ('"Dañado / Defectuoso"', 't("inventoryMgmt.damaged")'),
        ('"Devolución de cliente"', 't("inventoryMgmt.returned")'),
        ('"Vendido fuera de línea"', 't("inventoryMgmt.soldOffline")'),
        ('"Historial de Movimientos de Stock"', 't("inventoryMgmt.stockMovementHistory")'),
        ('"Cambios recientes de inventario"', 't("inventoryMgmt.recentChanges")'),
        ('"Sin movimientos de stock aún"', 't("inventoryMgmt.noMovements")'),
        ("'Ingresa una cantidad válida'", 't("inventoryMgmt.enterValidQty")'),
        ("'Error al ajustar stock'", 't("inventoryMgmt.failedAdjust")'),
        ('"Importar CSV"', 't("inventoryMgmt.importCSV")'),
    ],
    "modules/unatienda/tabs/OrderFormConfigTab.jsx": [
        ('"Configuración del Formulario de Pedido"', 't("orderFormConfig.title")'),
        ('"Gestiona los campos que aparecen en el formulario de pedido de textos"', 't("orderFormConfig.titleDesc")'),
        ('"Mostrar inactivos"', 't("orderFormConfig.showInactive")'),
        ('"Agregar Campo"', 't("orderFormConfig.addField")'),
        ('"Agregar primer campo"', 't("orderFormConfig.addFirstField")'),
        ('"No hay campos configurados"', 't("orderFormConfig.noFieldsConfigured")'),
        ('"Editar Campo"', 't("orderFormConfig.editField")'),
        ('"Nuevo Campo"', 't("orderFormConfig.newField")'),
        ('"Tipo de Campo *"', 't("orderFormConfig.fieldType")'),
        ('"Nombre (EN) *"', 't("orderFormConfig.nameEN")'),
        ('"Nombre (ES)"', 't("orderFormConfig.nameES")'),
        ('"Nombre (ZH)"', 't("orderFormConfig.nameZH")'),
        ('"Campo requerido"', 't("orderFormConfig.requiredField")'),
        ("'Campo creado'", 't("orderFormConfig.fieldCreated")'),
        ("'Campo actualizado'", 't("orderFormConfig.fieldUpdated")'),
        ("'Campo eliminado'", 't("orderFormConfig.fieldDeleted")'),
        ("'Campo activado'", 't("orderFormConfig.fieldActivated")'),
        ("'Campo desactivado'", 't("orderFormConfig.fieldDeactivated")'),
        ("'El nombre del campo es requerido'", 't("orderFormConfig.fieldNameRequired")'),
        ("'Error al cargar configuración'", 't("orderFormConfig.configLoadError")'),
        ("'Error al guardar campo'", 't("orderFormConfig.saveError")'),
    ],
    "modules/admin/store/StoreAnalyticsModule.jsx": [
        ('"Reportes y Analíticas"', 't("analytics.title")'),
        ('"Inteligencia de negocios para decisiones de compra"', 't("analytics.titleDesc")'),
        ('"Resumen"', 't("analytics.overviewTab")'),
        ('"Ingresos"', 't("analytics.revenueTab")'),
        ('"Inventario"', 't("analytics.inventoryTab")'),
        ('"Libros"', 't("analytics.booksTab")'),
        ('"Clientes"', 't("analytics.clientsTab")'),
        ('"Grados"', 't("analytics.gradesTab")'),
        ('"Recomendaciones de Compra"', 't("analytics.purchaseRecommendations")'),
        ('"Tendencias Mensuales"', 't("analytics.monthlyTrends")'),
        ('"Ingresos por Estado de Pedido"', 't("analytics.revenueByStatus")'),
        ('"Resumen de Ingresos"', 't("analytics.revenueSummary")'),
        ('"Pedido Promedio"', 't("analytics.averageOrder")'),
        ('"Rendimiento de Ventas de Libros"', 't("analytics.bookSalesPerformance")'),
        ('"Unidades Vendidas"', 't("analytics.unitsSold")'),
        ('"Mejores Clientes por Gasto"', 't("analytics.topClientsBySpending")'),
        ('"Rendimiento por Grado"', 't("analytics.performanceByGrade")'),
        ('"Acceso denegado. Se requiere Super admin."', 't("analytics.accessDenied")'),
        ("'Error al cargar analíticas'", 't("analytics.loadError")'),
    ],
}

total = 0
for relpath, pairs in REPLACEMENTS.items():
    fp = os.path.join(BASE, relpath)
    if not os.path.exists(fp):
        print(f"  SKIP: {relpath}")
        continue
    with open(fp, 'r') as f:
        content = f.read()
    
    count = 0
    for old, new in pairs:
        if old in content:
            content = content.replace(old, new, 1)
            count += 1
    
    with open(fp, 'w') as f:
        f.write(content)
    print(f"  {relpath}: {count}/{len(pairs)} replacements")
    total += count

print(f"\nTotal: {total} replacements")
