<analysis>**original_problem_statement:**
The user's initial request was to build a rich and powerful tournament management feature. This evolved into a major refactoring and unification effort. The core goal became integrating the new tournament system (PinPan Arena) with existing features like SuperPin and RapidPin to create a cohesive PinPanClub experience. The latest request is to further unify the platform by creating a global referee system and an all-time player leaderboard to increase user engagement.

**User's preferred language**: English

**what currently exists?**
The application now has a unified PinPanClub module featuring:
-   **PinPan Arena:** A full-featured tournament management system for single/double elimination brackets, including creation, registration, live bracket visualization, and automated winner advancement.
-   **PinPan League:** The former SuperPin feature, refactored and renamed, for round-robin league play. It is now integrated with Arena, allowing moderators to create playoff tournaments directly from league standings.
-   **RapidPin:** For quick, informal matches.
-   **PinPan Live & TV:** A real-time spectator view (migrated from polling to WebSockets) and a public TV display mode, both of which now support displaying live Arena tournament brackets.
-   A public, shareable link for each tournament bracket.
-   Push notifications for key tournament events (registration opened, brackets generated, tournament complete).
-   A fragmented referee system exists within the League and RapidPin modules but is not a global, tracked feature.

**Last working item**:
- **Last item agent was working:** The agent was performing a detailed investigation of the existing, fragmented referee implementations across the , , and  modules. This was in preparation for building a unified, global referee system and an all-time leaderboard, as requested and approved by the user.
- **Status:** NOT STARTED
- **Agent Testing Done:** N
- **Which testing method agent to use?** both
- **User Testing Done:** N

**All Pending/In progress Issue list**:
None.

**In progress Task List**:
None.

**Upcoming and Future Tasks**
*   **Upcoming Tasks:**
    *   **(P0) Implement Unified Referee System & Global Leaderboard:**
        *   **Feature 1: Unified Referee System:**
            *   **Backend:**
                *   Create a central  model/service to allow admins to toggle referee requirements globally or per-module (Arena, League, RapidPin).
                *   Enhance the  model (or create a new  collection) to track referee-specific stats like matches officiated, user ratings, etc.
                *   Implement API endpoints for managing referee settings (admin-only) and fetching referee profiles.
            *   **Frontend:**
                *   Develop an admin UI to manage the global referee settings.
                *   Integrate a referee profile/stats section into the user's main profile page.
                *   Add a post-match UI for players to rate the referee, feeding into their profile stats.
        *   **Feature 2: All-Time Hall of Fame Leaderboard:**
            *   **Backend:**
                *   Develop a service that runs aggregation pipelines across all game modes (Arena, League, RapidPin) to compute and cache an all-time player ranking.
                *   Create a new API endpoint to serve the paginated leaderboard data.
            *   **Frontend:**
                *   Build a new Hall of Fame page to display the global, all-time player leaderboard.
*   **Future Tasks:**
    *   **(P3)** Build an on-demand landing page redesign tool.
    *   **(P4)** Extend Monday.com synchronization to the general product inventory.

**Completed work in this session**
- **Feature - PinPan Arena Tournament Module (DONE):** Built a complete tournament system from scratch, including backend models/services for the tournament lifecycle and frontend components for creation, a hub to list tournaments, and a detailed view with bracket visualization.
- **Refactor - Feature Unification (DONE):**
    - Renamed all user-facing instances of SuperPin to PinPan League for clarity.
    - Integrated the League with the new Arena by replacing the old tournament creation with a Create Playoff feature, which seeds an Arena tournament with top league players.
    - Renamed the Spectator feature to PinPan Live and updated corresponding UI elements.
- **Enhancement - Real-Time & Sharing Features (DONE):**
    - Migrated the  component from HTTP polling to WebSockets for live match updates.
    - Created a public, shareable page for tournament brackets.
    - Added a new Tournament mode to the  dashboard to display live Arena brackets.
    - Implemented push notifications for major tournament events (registration, start, completion).
- **Testing (DONE):** All new features and refactoring were successfully validated using the testing agent, and any reported issues were fixed.

**Earlier issues found/mentioned but not fixed**
None.

**Known issue recurrence from previous fork**
None.

**Code Architecture**


**Key Technical Concepts**
- **Modular Unification:** The main theme of the work was to unify disparate features (, ) into a cohesive experience under the  umbrella with clear naming (, ) and direct integrations ( ->  playoffs).
- **WebSocket Broadcasting:** The existing WebSocket infrastructure was extended to support dedicated channels for each tournament (), allowing for real-time broadcasting of match results to all connected clients (e.g., , ).
- **Public Routes:** A pattern for creating unauthenticated, public-facing pages was established with  to allow sharing of tournament progress.
- **Asynchronous Notifications:** The existing  (OneSignal) was leveraged to send push notifications for key tournament lifecycle events, handled in the backend .

**key DB schema**
-   ****: (NEW) Stores tournament configuration, including name, format, status, and settings.
-   ****: (NEW) A mapping collection linking users to the tournaments they have joined.
-   ****: (NEW) Contains data for every match within a tournament, detailing the round, players, score, and winner.
-   ****: Existing collection, to be analyzed for storing or linking to new global referee statistics.

**All files of reference**
-   **For upcoming task (Referee/Leaderboard):**
    -   : The core service for standard matches, a candidate for centralizing referee logic.
    -   : The user model, which may be extended to store referee stats.
    -   : Likely location for the new admin panel for referee settings.
    -   : Where the new Hall of Fame leaderboard page will be created.
-   **Recently created:**
    -   All files in .
    -   .

**Critical Info for New Agent**
-   The user's primary focus has shifted from feature creation to feature unification and engagement. The next tasks (unified referees, global leaderboard) are critical to this goal.
-   The user has explicitly approved the plan to build the unified referee system and the Hall of Fame leaderboard. Your first action should be to start implementing the backend for these features.
-   When implementing the referee system, the key is to create a *centralized* service and data model, avoiding the fragmented pattern of the old implementation. The system should be manageable by admins via a new settings toggle.

**documents and test reports created in this job**
-   
-   
-    (Updated)

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Go with the enhancement (shareable pages, TV mode, etc.) and the Next Action Items.
2.  **User:** I remember we have referees role build for each game, I am thinking will be fine if we convert this as core feature for across PinPanClub, but leaving option for moderator and admin toggle of or on for each game, by default activated for all. Can you review this referees feature and maybe need improve it more? (PENDING)
3.  **Agent:** Agreed to investigate the referee feature.
4.  **Agent:** Completed the investigation across PinPanClub, RapidPin, and SuperPin matches.
5.  **Agent:** Presented findings, confirming referees are used but not tracked globally or consistently.
6.  **User:** Yes, if you can add something more about referees you can do it, the purpose is adding this role to adding more engagement for the game, the game and effort not only 2 players. (PENDING)
7.  **Agent:** Understood the user's philosophy and proposed a plan for a unified referee system with profiles/ratings and a global Hall of Fame leaderboard.
8.  **Agent:** Started investigating the codebase to implement the approved plan.

**Project Health Check:**
*   **Broken:** None
*   **Mocked:** None

**3rd Party Integrations**
*   OneSignal (Push Notifications)
*   Monday.com API v2
*   Google Photos, Gmail, Telegram Bot API
*   OpenAI & Anthropic LLMs
*   OpenAI TTS (via Emergent LLM Key) & ElevenLabs TTS (via User API Key)
*    &  for WebSockets

**Testing status**
-   **Testing agent used after significant changes:** YES
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** None
-   **Known regressions:** None

**Credentials to test flow:**
*   **Email:** 
*   **Password:** 

**What agent forgot to execute**
The agent has followed the user's requests and is currently in the planning/investigation phase for the next approved set of tasks. Nothing was forgotten.</analysis>
